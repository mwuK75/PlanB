<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PlanB - ホーム</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="page-home">

<div id="app-container">
    <header>
        <a href="#" class="logo">
            <span>PlanB</span>
        </a>
        
        <div class="header-actions">
            <button class="btn-transparent" onclick="handleLogout()">ログアウト</button>
            <button class="btn-transparent icon-btn">💬</button>
        </div>
    </header>

    <main>
        <div id="phase-home">
            <div class="hero-section">
                <div class="hero-text">
                    <h2>予定、崩れちゃった？</h2>
                    <p>今の状況を教えて。AIが代わりの案を<br>最速で提案します。</p>
                </div>
            </div>

            <div class="plan-selection-section">
                <h2 class="selection-title" id="selectionTitle">どんな状況ですか？</h2>

                <div class="cards-grid" id="planCards">
                    </div>

                <div class="emergency-section">
                    <button id="modeToggleBtn" class="mode-btn mode-btn-danger" onclick="toggleEmergencyMode()">
                        <span id="modeEmoji" class="mode-btn-emoji">🚨</span>
                        <span class="mode-btn-text">
                            <span id="modeText">緊急モード</span>
                        </span>
                    </button>
                </div>
            </div>
        </div>

        <div id="phase-loading">
            <div class="spinner"></div>
            <h3>AIがPlanBを生成中...</h3>
            <p id="loading-text"></p>
        </div>
    </main>
</div>

<script>
    // データ定義
    const normalModeCards = [
        { title: "今から１時間以内で行ける近場", emoji: "📍", situation: "near" },
        { title: "今日の気分", emoji: "😊", situation: "mood" },
        { title: "屋内プラン", emoji: "🏢", situation: "indoor" }
    ];

    const emergencyModeCards = [
        { title: "30分でできること", emoji: "⏱️", situation: "quick" },
        { title: "人込みで疲れた", emoji: "😫", situation: "crowded" },
        { title: "ドタキャンされた", emoji: "😢", situation: "cancel" }
    ];

    let isEmergencyMode = false;

    // ログアウト
    function handleLogout() {
        console.log("ログアウトしました");
        window.location.href = 'login.html';
    }

    // カード描画
    function renderCards(cards) {
        const container = document.getElementById('planCards');
        container.innerHTML = '';

        cards.forEach(card => {
            const cardElement = document.createElement('div');
            cardElement.className = 'plan-card';
            cardElement.onclick = () => handleSelectPlan(card.situation);
            cardElement.innerHTML = `
                <span class="emoji">${card.emoji}</span>
                <h3>${card.title}</h3>
            `;
            container.appendChild(cardElement);
        });
    }

    // プラン選択
    function handleSelectPlan(situation) {
        document.getElementById('phase-home').style.display = 'none';
        document.getElementById('phase-loading').style.display = 'flex';

        const loadingTexts = {
            'near': '近くのスポットを探しています',
            'mood': '気分に合ったプランを探しています',
            'indoor': '屋内の遊び場を探しています',
            'quick': '30分でできることを探しています',
            'crowded': '落ち着ける場所を探しています',
            'cancel': 'リカバリープランを生成中'
        };

        document.getElementById('loading-text').textContent = loadingTexts[situation] || '検索中...';

        setTimeout(() => {
            window.location.href = `result.html?situation=${situation}`;
        }, 1500);
    }

    // 緊急モード切り替え
    function toggleEmergencyMode() {
        isEmergencyMode = !isEmergencyMode;

        const titleElement = document.getElementById('selectionTitle');
        const btnElement = document.getElementById('modeToggleBtn');
        const textElement = document.getElementById('modeText');
        const emojiElement = document.getElementById('modeEmoji');

        if (isEmergencyMode) {
            renderCards(emergencyModeCards);
            titleElement.textContent = "緊急サポート: 状況を選んでください";
            titleElement.style.color = "#dc2626";
            
            btnElement.classList.remove('mode-btn-danger');
            btnElement.classList.add('mode-btn-safe');
            textElement.textContent = "通常モードに戻る";
            emojiElement.textContent = "🏠";
        } else {
            renderCards(normalModeCards);
            titleElement.textContent = "どんな状況ですか？";
            titleElement.style.color = "#1f2937";
            
            btnElement.classList.remove('mode-btn-safe');
            btnElement.classList.add('mode-btn-danger');
            textElement.textContent = "緊急モード";
            emojiElement.textContent = "🚨";
        }
    }

    window.addEventListener('load', () => {
        renderCards(normalModeCards);
    });
</script>

</body>
</html>